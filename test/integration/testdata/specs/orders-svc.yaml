openapi: "3.0.3"
info:
  title: Orders Service API
  version: "1.0.0"
  description: Backend API for the Orders domain.

servers:
  - url: "{{ORDERS_SVC_URL}}"
    description: Test orders service

paths:
  /api/orders:
    get:
      operationId: listOrders
      summary: List orders with pagination and filtering.
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 25
        - name: sort
          in: query
          schema:
            type: string
        - name: sort_dir
          in: query
          schema:
            type: string
            enum: [asc, desc]
        - name: status
          in: query
          schema:
            type: string
        - name: priority
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Paginated list of orders.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Order"
                  total_count:
                    type: integer
                  page:
                    type: integer
                  page_size:
                    type: integer

  /api/orders/search:
    get:
      operationId: searchOrders
      summary: Search orders by query string.
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Search results.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Order"
                  total_count:
                    type: integer

  /api/customers/search:
    get:
      operationId: searchCustomers
      summary: Search customers by query string.
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Customer search results.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        name:
                          type: string
                        email:
                          type: string

  /api/orders/statuses:
    get:
      operationId: getOrderStatuses
      summary: Get available order statuses.
      responses:
        "200":
          description: List of order statuses.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LookupOption"

  /api/orders/counts:
    get:
      operationId: getOrderCounts
      summary: Get order counts by status.
      responses:
        "200":
          description: Order counts.
          content:
            application/json:
              schema:
                type: object
                properties:
                  pending_count:
                    type: integer
                  processing_count:
                    type: integer
                  total_count:
                    type: integer

  /api/orders/{id}:
    get:
      operationId: getOrder
      summary: Get a single order by ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Order details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "404":
          description: Order not found.

    patch:
      operationId: updateOrder
      summary: Update an order.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                shipping_address:
                  type: string
                priority:
                  type: string
                  enum: [normal, high, urgent]
                notes:
                  type: string
                internal_code:
                  type: string
      responses:
        "200":
          description: Updated order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "404":
          description: Order not found.
        "422":
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/orders/{id}/cancel:
    post:
      operationId: cancelOrder
      summary: Cancel an order.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "200":
          description: Cancelled order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "422":
          description: Cannot cancel order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/orders/{id}/confirm:
    post:
      operationId: confirmOrder
      summary: Confirm/approve an order.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                approval_notes:
                  type: string
      responses:
        "200":
          description: Confirmed order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "422":
          description: Cannot confirm order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    Order:
      type: object
      properties:
        id:
          type: string
        order_number:
          type: string
        customer_name:
          type: string
        total_amount:
          type: number
          format: double
        status:
          type: string
          enum: [pending, processing, shipped, cancelled, approved, rejected]
        priority:
          type: string
          enum: [normal, high, urgent]
        shipping_address:
          type: string
        notes:
          type: string
        internal_code:
          type: string
        items:
          type: array
          items:
            $ref: "#/components/schemas/LineItem"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    LineItem:
      type: object
      properties:
        product_name:
          type: string
        quantity:
          type: integer
        unit_price:
          type: number
          format: double
        total:
          type: number
          format: double

    LookupOption:
      type: object
      properties:
        label:
          type: string
        value:
          type: string

    ErrorResponse:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
